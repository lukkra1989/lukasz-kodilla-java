CREATE TABLE BOOKS_AUD(
	EVENT_ID INT(15) NOT NULL AUTO_INCREMENT,
	EVENT_DATE DATETIME NOT NULL,
	EVENT_TYPE VARCHAR(11) DEFAULT NULL,
	OLD_BOOK_ID INT(11),
    NEW_BOOK_ID INT(11),
	OLD_BOOK_TITLE VARCHAR(30),
	NEW_BOOK_TITLE VARCHAR(30),
	OLD_PUBYEAR INT(4),
	NEW_PUBYEAR INT(4)

);


CREATE TABLE READERS_AUD(
	READER_ID INT (15) NOT NULL AUTO_INCREMENT,
	EVENT_DATE DATETIME NOT NULL,
	EVENT_TYPE VARCHAR(11) DEFAULT NULL,
	OLD_FIRSTNAME VARCHAR(15),
	NEW_FIRSTNAME VARCHAR(15),
	OLD_LASTNAME VARCHAR (15),
	NEW_LASTNAME VARCHAR (15),
	OLD_PESELID INT(12),
	NEW_PESELID INT(12),
	OLD_VIP_LEVEL VARCHAR (20),
	NEW_VIP_LEVEL VARCHAR (20)

);

DELIMITER $$

CREATE TRIGGER BOOK_INSERT AFTER INSERT ON BOOKS
FOR EACH ROW
BEGIN
	INSERT INTO BOOKS_AUD (EVENT_DATE, EVENT_TYPE, 		NEW_BOOK_ID, NEW_BOOK_TITLE, NEW_PUBYEAR)
	VALUE (CURTIME(), "INSERT", NEW.BOOK_ID, NEW.BOOK_TITLE, NEW.PUBYEAR );
END


CREATE TRIGGER READERS_INSERT AFTER INSERT ON READERS_AUD
FOR EACH ROW
BEGIN	
	INSERT INTO READERS_AUD( READER_ID, NEW_FIRSTNAME, NEW_LASTNAME, NEW_PESELID, NEW_VIP_LEVEL)
	VALUE (CURTIME(), "INSERT", NEW.FIRSTNAME, NEW.LASTNAME, NEW.PESELID, NEW.VIP_LEVEL);
END
	
CREATE TRIGGER BOOKS_DELETE	AFTER DELETE ON BOOKS 
FOR EACH ROW
BEGIN
	INSERT INTO BOOKS_AUD (EVENT_DATE, EVENT_TYPE, BOOK_ID)
	VALUE (CURTIME(), "DELETE", OLD.BOOK_ID);
	
CREATE TRIGGER READERS_DELETE	AFTER DELETE ON READERS_AUD
FOR EACH ROW
BEGIN
	INSERT INTO READERS_AUD (EVENT_DATE, EVENT_TYPE, READER_ID)
	VALUE (CURTIME(), "DELETE", OLD.READER_ID);


CREATE TRIGGER BOOKS_UPDATE AFTER UPDATE ON BOOKS
FOR EACH ROW
BEGIN
	INSERT INTO BOOKS_AUD (EVENT_DATE, EVENT_TYPE, BOOK_ID)
	VALUE(CURTIME(), "DELETE", OLD.BOOK_ID);
	
CREATE TRIGGER READERS_UPDATE AFTER UPDATE ON READERS
FOR EACH ROW
BEGIN
	INSERT INTO READERS_AUD (EVENT_DATE, EVENT_TYPE, READER_ID)
	VALUE(CURTIME(), "DELETE", OLD.READERS_ID);
	
END $$

DELIMITER ;
























